<div class="animate-fade-in-up space-y-6">
  <!-- Header -->
  <div class="flex items-center justify-between">
    <div class="flex items-center gap-4">
      <a routerLink="/admin/dashboard" class="soft-btn-icon text-text-light">
        <fa-icon [icon]="faArrowLeft"></fa-icon>
      </a>
      <h2 class="text-3xl font-bold text-text">ä½¿ç”¨è€…ç®¡ç†</h2>
    </div>
    <div class="flex items-center gap-3">
      <button (click)="syncUsersPhotoURL()"
              [disabled]="syncLoading"
              class="soft-btn bg-blue-100 text-blue-600 hover:bg-blue-200 disabled:opacity-50"
              title="é‡æ–°åŒæ­¥æ‰€æœ‰ä½¿ç”¨è€…çš„é ­åƒ">
        <fa-icon [icon]="faSpinner" class="animate-spin" *ngIf="syncLoading"></fa-icon>
        <span *ngIf="!syncLoading">ğŸ”„ åŒæ­¥é ­åƒ</span>
        <span *ngIf="syncLoading">åŒæ­¥ä¸­...</span>
      </button>
      <button (click)="openAdd()" class="soft-btn soft-btn-primary px-6">
        æ–°å¢ä½¿ç”¨è€…
      </button>
    </div>
  </div>

  <!-- Users List -->
  <div class="space-y-4">
    <div class="soft-card overflow-hidden !p-0">
      <div class="overflow-x-auto">
        <table class="w-full text-left border-collapse">
          <thead class="bg-gray-50/50 border-b border-gray-200">
            <tr>
              <th class="px-6 py-4 text-sm font-bold text-text-light uppercase tracking-wider">ä½¿ç”¨è€…</th>
              <th class="px-6 py-4 text-sm font-bold text-text-light uppercase tracking-wider">è§’è‰²</th>
              <th class="px-6 py-4 text-sm font-bold text-text-light uppercase tracking-wider">ç‹€æ…‹</th>
              <th class="px-6 py-4 text-sm font-bold text-text-light uppercase tracking-wider text-right">æ“ä½œ</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100">
            <tr *ngFor="let user of users$ | async" class="hover:bg-white/50 transition-colors">
              <!-- User Info -->
              <td class="px-6 py-4">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 rounded-full overflow-hidden bg-gray-100 shadow-soft-inset flex-shrink-0">
                    <img *ngIf="user.photoURL" [src]="user.photoURL" [alt]="user.displayName" class="w-full h-full object-cover">
                    <div *ngIf="!user.photoURL" class="w-full h-full flex items-center justify-center text-primary bg-surface">
                      <fa-icon [icon]="faUser"></fa-icon>
                    </div>
                  </div>
                  <div class="min-w-0">
                    <div class="font-bold text-text truncate">{{ user.displayName || 'æœªè¨­å®šåç¨±' }}</div>
                    <div class="text-xs text-text-light truncate">{{ user.email }}</div>
                  </div>
                </div>
              </td>

              <!-- Role -->
              <td class="px-6 py-4">
                <div class="flex items-center gap-2">
                  <span [class]="user.isAdmin ? 'bg-primary/10 text-primary' : 'bg-gray-100 text-text-light'"
                        class="px-2 py-1 rounded-md text-xs font-bold flex items-center gap-1">
                    <fa-icon [icon]="faUserShield" *ngIf="user.isAdmin"></fa-icon>
                    {{ user.isAdmin ? 'ç®¡ç†å“¡' : 'ä¸€èˆ¬ä½¿ç”¨è€…' }}
                  </span>
                </div>
              </td>

              <!-- Status -->
              <td class="px-6 py-4">
                <span [class]="user.status === 'active' ? 'text-success' : 'text-danger'"
                      class="flex items-center gap-1 text-sm font-medium">
                  <fa-icon [icon]="user.status === 'active' ? faCheckCircle : faTimesCircle"></fa-icon>
                  {{ user.status === 'active' ? 'æ­£å¸¸' : 'å·²åœç”¨' }}
                </span>
              </td>

              <!-- Actions -->
              <td class="px-6 py-4 text-right">
                <div class="flex items-center justify-end gap-2">
                  <button (click)="toggleAdmin(user)" 
                          class="soft-btn text-xs py-1.5 px-3 bg-gray-100 hover:bg-primary/10 hover:text-primary transition-all"
                          [title]="user.isAdmin ? 'ç§»é™¤ç®¡ç†å“¡' : 'è¨­ç‚ºç®¡ç†å“¡'">
                    <fa-icon [icon]="faUserShield"></fa-icon>
                    <span class="ml-1 hidden md:inline">{{ user.isAdmin ? 'é™ç´š' : 'å‡ç´š' }}</span>
                  </button>
                  <button (click)="toggleStatus(user)" 
                          [class]="user.status === 'active' ? 'hover:bg-danger/10 hover:text-danger' : 'hover:bg-success/10 hover:text-success'"
                          class="soft-btn text-xs py-1.5 px-3 bg-gray-100 transition-all"
                          [title]="user.status === 'active' ? 'åœç”¨å¸³è™Ÿ' : 'å•Ÿç”¨å¸³è™Ÿ'">
                    <fa-icon [icon]="user.status === 'active' ? faUserSlash : faUser"></fa-icon>
                    <span class="ml-1 hidden md:inline">{{ user.status === 'active' ? 'åœç”¨' : 'å•Ÿç”¨' }}</span>
                  </button>
                  <button (click)="deleteUser(user)" 
                          *ngIf="user.id !== currentUser()?.id"
                          class="soft-btn text-xs py-1.5 px-3 bg-gray-100 hover:bg-danger/10 hover:text-danger transition-all text-danger"
                          title="åˆªé™¤ä½¿ç”¨è€…">
                    <fa-icon [icon]="faTrash"></fa-icon>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <app-user-dialog *ngIf="showDialog" (close)="closeDialog()"></app-user-dialog>
</div>
