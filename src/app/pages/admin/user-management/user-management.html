<div class="animate-fade-in-up space-y-6">
  <!-- Header -->
  <div class="flex items-center justify-between">
    <div class="flex items-center gap-4">
      <a routerLink="/admin/dashboard" class="soft-btn-icon text-text-light">
        <fa-icon [icon]="faArrowLeft"></fa-icon>
      </a>
      <h2 class="text-3xl font-bold text-text">使用者管理</h2>
    </div>
    <button (click)="openAdd()" class="soft-btn soft-btn-primary px-6">
      新增使用者
    </button>
  </div>

  <!-- Users List -->
  <div class="space-y-4">
    <div class="soft-card overflow-hidden !p-0">
      <div class="overflow-x-auto">
        <table class="w-full text-left border-collapse">
          <thead class="bg-gray-50/50 border-b border-gray-200">
            <tr>
              <th class="px-6 py-4 text-sm font-bold text-text-light uppercase tracking-wider">使用者</th>
              <th class="px-6 py-4 text-sm font-bold text-text-light uppercase tracking-wider">角色</th>
              <th class="px-6 py-4 text-sm font-bold text-text-light uppercase tracking-wider">狀態</th>
              <th class="px-6 py-4 text-sm font-bold text-text-light uppercase tracking-wider text-right">操作</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100">
            <tr *ngFor="let user of users$ | async" class="hover:bg-white/50 transition-colors">
              <!-- User Info -->
              <td class="px-6 py-4">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 rounded-full overflow-hidden bg-gray-100 shadow-soft-inset flex-shrink-0">
                    <img *ngIf="user.photoURL" [src]="user.photoURL" [alt]="user.displayName" class="w-full h-full object-cover">
                    <div *ngIf="!user.photoURL" class="w-full h-full flex items-center justify-center text-primary bg-surface">
                      <fa-icon [icon]="faUser"></fa-icon>
                    </div>
                  </div>
                  <div class="min-w-0">
                    <div class="font-bold text-text truncate">{{ user.displayName || '未設定名稱' }}</div>
                    <div class="text-xs text-text-light truncate">{{ user.email }}</div>
                  </div>
                </div>
              </td>

              <!-- Role -->
              <td class="px-6 py-4">
                <div class="flex items-center gap-2">
                  <span [class]="user.isAdmin ? 'bg-primary/10 text-primary' : 'bg-gray-100 text-text-light'"
                        class="px-2 py-1 rounded-md text-xs font-bold flex items-center gap-1">
                    <fa-icon [icon]="faUserShield" *ngIf="user.isAdmin"></fa-icon>
                    {{ user.isAdmin ? '管理員' : '一般使用者' }}
                  </span>
                </div>
              </td>

              <!-- Status -->
              <td class="px-6 py-4">
                <span [class]="user.status === 'active' ? 'text-success' : 'text-danger'"
                      class="flex items-center gap-1 text-sm font-medium">
                  <fa-icon [icon]="user.status === 'active' ? faCheckCircle : faTimesCircle"></fa-icon>
                  {{ user.status === 'active' ? '正常' : '已停用' }}
                </span>
              </td>

              <!-- Actions -->
              <td class="px-6 py-4 text-right">
                <div class="flex items-center justify-end gap-2">
                  <button (click)="toggleAdmin(user)" 
                          class="soft-btn text-xs py-1.5 px-3 bg-gray-100 hover:bg-primary/10 hover:text-primary transition-all"
                          [title]="user.isAdmin ? '移除管理員' : '設為管理員'">
                    <fa-icon [icon]="faUserShield"></fa-icon>
                    <span class="ml-1 hidden md:inline">{{ user.isAdmin ? '降級' : '升級' }}</span>
                  </button>
                  <button (click)="toggleStatus(user)" 
                          [class]="user.status === 'active' ? 'hover:bg-danger/10 hover:text-danger' : 'hover:bg-success/10 hover:text-success'"
                          class="soft-btn text-xs py-1.5 px-3 bg-gray-100 transition-all"
                          [title]="user.status === 'active' ? '停用帳號' : '啟用帳號'">
                    <fa-icon [icon]="user.status === 'active' ? faUserSlash : faUser"></fa-icon>
                    <span class="ml-1 hidden md:inline">{{ user.status === 'active' ? '停用' : '啟用' }}</span>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <app-user-dialog *ngIf="showDialog" (close)="closeDialog()"></app-user-dialog>
</div>
