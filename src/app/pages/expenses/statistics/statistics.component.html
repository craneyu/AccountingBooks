<div class="w-full bg-gradient-to-br from-gray-50 to-gray-100 rounded-lg p-6 space-y-6">
  <!-- 頭部 -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
    <div>
      <h2 class="text-2xl md:text-3xl font-bold text-gray-800">統計與圖表</h2>
      <p class="text-sm text-gray-500 mt-1">支出數據分析與可視化</p>
    </div>

    <!-- 幣別選擇 -->
    <div class="flex items-center gap-3">
      <label class="text-sm font-medium text-gray-700">選擇幣別：</label>
      <select
        [(ngModel)]="selectedCurrency"
        (change)="onCurrencyChange()"
        class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent text-gray-700"
      >
        <option *ngFor="let currency of currencies()" [value]="currency">
          {{ currency }}
        </option>
      </select>
    </div>
  </div>

  <!-- 摘要卡片 -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
    <!-- 總金額 -->
    <div class="bg-white rounded-lg shadow-soft p-4 border-l-4 border-teal-500">
      <p class="text-xs font-semibold text-gray-500 uppercase tracking-wide">總支出</p>
      <p class="text-2xl font-bold text-gray-800 mt-2">{{ summary().totalAmount | number: '1.0-2' }}</p>
      <p class="text-xs text-gray-500 mt-1">{{ selectedCurrency() }}</p>
    </div>

    <!-- 筆數 -->
    <div class="bg-white rounded-lg shadow-soft p-4 border-l-4 border-blue-500">
      <p class="text-xs font-semibold text-gray-500 uppercase tracking-wide">支出筆數</p>
      <p class="text-2xl font-bold text-gray-800 mt-2">{{ summary().totalCount }}</p>
      <p class="text-xs text-gray-500 mt-1">筆</p>
    </div>

    <!-- 平均支出 -->
    <div class="bg-white rounded-lg shadow-soft p-4 border-l-4 border-purple-500">
      <p class="text-xs font-semibold text-gray-500 uppercase tracking-wide">平均支出</p>
      <p class="text-2xl font-bold text-gray-800 mt-2">{{ summary().averageAmount | number: '1.0-2' }}</p>
      <p class="text-xs text-gray-500 mt-1">{{ selectedCurrency() }}</p>
    </div>

    <!-- 最高支出 -->
    <div class="bg-white rounded-lg shadow-soft p-4 border-l-4 border-red-500">
      <p class="text-xs font-semibold text-gray-500 uppercase tracking-wide">最高支出</p>
      <p class="text-2xl font-bold text-gray-800 mt-2">{{ summary().maxAmount | number: '1.0-2' }}</p>
      <p class="text-xs text-gray-500 mt-1">{{ selectedCurrency() }}</p>
    </div>

    <!-- 最低支出 -->
    <div class="bg-white rounded-lg shadow-soft p-4 border-l-4 border-green-500">
      <p class="text-xs font-semibold text-gray-500 uppercase tracking-wide">最低支出</p>
      <p class="text-2xl font-bold text-gray-800 mt-2">{{ summary().minAmount | number: '1.0-2' }}</p>
      <p class="text-xs text-gray-500 mt-1">{{ selectedCurrency() }}</p>
    </div>
  </div>

  <!-- 圖表容器 -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- 分類圓餅圖 -->
    <div class="bg-white rounded-lg shadow-soft p-6">
      <div class="flex items-center gap-2 mb-4">
        <fa-icon [icon]="faChartPie" class="text-teal-500 text-lg"></fa-icon>
        <h3 class="text-lg font-semibold text-gray-800">支出分類佔比</h3>
      </div>
      <div *ngIf="expenses.length > 0" class="relative h-64">
        <canvas
          baseChart
          [data]="categoryChartData()"
          type="doughnut"
          [options]="pieChartOptions"
        ></canvas>
      </div>
      <div *ngIf="expenses.length === 0" class="h-64 flex items-center justify-center text-gray-500">
        暫無數據
      </div>

      <!-- 分類詳細列表 -->
      <div class="mt-4 pt-4 border-t border-gray-200 space-y-2 max-h-48 overflow-y-auto">
        <div *ngFor="let stat of categoryStats()" class="flex items-center justify-between text-sm">
          <div class="flex items-center gap-2">
            <div class="w-3 h-3 rounded-full" [style.backgroundColor]="'#4fd1c5'"></div>
            <span class="text-gray-700">{{ stat.category }}</span>
          </div>
          <div class="flex items-center gap-3">
            <span class="text-gray-600">{{ stat.count }} 筆</span>
            <span class="font-semibold text-gray-800 w-20 text-right">{{ stat.percentage }}%</span>
          </div>
        </div>
      </div>
    </div>

    <!-- 每日趨勢折線圖 -->
    <div class="bg-white rounded-lg shadow-soft p-6">
      <div class="flex items-center gap-2 mb-4">
        <fa-icon [icon]="faChartLine" class="text-blue-500 text-lg"></fa-icon>
        <h3 class="text-lg font-semibold text-gray-800">每日支出趨勢</h3>
      </div>
      <div *ngIf="expenses.length > 0" class="relative h-64">
        <canvas
          baseChart
          [data]="dailyTrendChartData()"
          type="line"
          [options]="lineChartOptions"
        ></canvas>
      </div>
      <div *ngIf="expenses.length === 0" class="h-64 flex items-center justify-center text-gray-500">
        暫無數據
      </div>
    </div>

    <!-- 個人支出長條圖 -->
    <div class="bg-white rounded-lg shadow-soft p-6">
      <div class="flex items-center gap-2 mb-4">
        <fa-icon [icon]="faChartBar" class="text-purple-500 text-lg"></fa-icon>
        <h3 class="text-lg font-semibold text-gray-800">個人支出佔比</h3>
      </div>
      <div *ngIf="memberStats().length > 0" class="relative h-64">
        <canvas
          baseChart
          [data]="memberChartData()"
          type="bar"
          [options]="barChartOptions"
        ></canvas>
      </div>
      <div *ngIf="memberStats().length === 0" class="h-64 flex items-center justify-center text-gray-500">
        暫無數據
      </div>

      <!-- 成員詳細列表 -->
      <div class="mt-4 pt-4 border-t border-gray-200 space-y-2 max-h-48 overflow-y-auto">
        <div *ngFor="let stat of memberStats()" class="flex items-center justify-between text-sm">
          <span class="text-gray-700 truncate">{{ stat.memberName }}</span>
          <div class="flex items-center gap-3">
            <span class="text-gray-600 text-xs">{{ stat.count }} 筆</span>
            <span class="font-semibold text-gray-800 w-20 text-right">{{ stat.percentage }}%</span>
          </div>
        </div>
      </div>
    </div>

    <!-- 支付方式長條圖 -->
    <div class="bg-white rounded-lg shadow-soft p-6">
      <div class="flex items-center gap-2 mb-4">
        <fa-icon [icon]="faChartBar" class="text-orange-500 text-lg"></fa-icon>
        <h3 class="text-lg font-semibold text-gray-800">支付方式統計</h3>
      </div>
      <div *ngIf="paymentMethodStats().length > 0" class="relative h-64">
        <canvas
          baseChart
          [data]="paymentMethodChartData()"
          type="bar"
          [options]="barChartOptions"
        ></canvas>
      </div>
      <div *ngIf="paymentMethodStats().length === 0" class="h-64 flex items-center justify-center text-gray-500">
        暫無數據
      </div>

      <!-- 支付方式詳細列表 -->
      <div class="mt-4 pt-4 border-t border-gray-200 space-y-2 max-h-48 overflow-y-auto">
        <div *ngFor="let stat of paymentMethodStats()" class="flex items-center justify-between text-sm">
          <span class="text-gray-700">{{ stat.paymentMethod }}</span>
          <div class="flex items-center gap-3">
            <span class="text-gray-600 text-xs">{{ stat.count }} 筆</span>
            <span class="font-semibold text-gray-800 w-20 text-right">{{ stat.percentage }}%</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
